#!/bin/sh -e

GREEN='\033[1;32m'
YELLOW='\033[1;33m'
RED='\033[1;31m'
NC='\033[0m'

SYSTEM_TYPE="x86_64-darwin"
FLAKE_SYSTEM="darwinConfigurations.darwin-otsk.${SYSTEM_TYPE}.system"

export NIXPKGS_ALLOW_UNFREE=1

echo "${YELLOW}Applying work MacBook configuration (Home Manager only, no sudo required)...${NC}"

# Use Home Manager directly instead of nix-darwin to avoid sudo requirements
nix run home-manager/master -- switch --flake .#skagur-work-intel $@

echo "${YELLOW}Cleaning up...${NC}"
# Clean up any result symlinks that might have been created
if [ -L ./result ]; then
  unlink ./result
fi

echo "${GREEN}Work MacBook configuration applied successfully!${NC}"
echo ""
echo "${YELLOW}Note: This configuration only manages user-space settings.${NC}"
echo "${YELLOW}System-level preferences need to be configured manually.${NC}"